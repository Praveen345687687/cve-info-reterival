import React, { useEffect, useState } from "react";
import cve_api from "../utils/cve_api"; // Import the correct API fetching function

const CVEDetails = ({ selectedItem }) => {
  const [cveDetails, setCveDetails] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchCVEData = async () => {
      setLoading(true);
      try {
        if (!selectedItem || !selectedItem.cve || !selectedItem.cve.id) {
          throw new Error("Invalid selected item or ID");
        }
        // Fetch data based on the selected item's ID
        const responseData = await cve_api(selectedItem.cve.id);
        setCveDetails(responseData);
      } catch (error) {
        console.error("Error fetching CVE data:", error.message);
      } finally {
        setLoading(false);
      }
    };

    fetchCVEData();
  }, [selectedItem]);
  const spacing = 1;
  return (
    <div>
      {loading ? (
        <div>Loading CVE data...</div>
      ) : (
        <div>
          {/* Display the retrieved CVE data */}
          {cveDetails && selectedItem && selectedItem.cve && (
            <div>
              <h3>{selectedItem.cve.id}</h3>
              <h4>Description:</h4>
              <p>{selectedItem.cve.descriptions[0].value}</p>
             <h4>CVSS V2 Metrics:</h4>
             <h5> Severity: {selectedItem.cve.metrics.cvssMetricV2[0].baseSeverity}    Score:{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.baseScore}</h5>
             <h5>Vector String:{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.vectorString}</h5>
             <h4>Scores:</h4>
             <table style={{borderCollapse: 'collapse', width: '100%', border: '2px solid black'}}>
  <thead>
    <tr style={{border: '2px solid black'}}>
      <th style={{border: '2px solid black', padding: '8px'}} colSpan="2">Access Vector</th>
      <th style={{border: '2px solid black', padding: '8px'}} colSpan="2">Access Complexity</th>
      <th style={{border: '2px solid black', padding: '8px'}} colSpan="2">Authentication</th>
      <th style={{border: '2px solid black', padding: '8px'}} colSpan="2">Confidentiality Impact</th>
      <th style={{border: '2px solid black', padding: '8px'}} colSpan="2">Integrity Impact</th>
      <th style={{border: '2px solid black', padding: '8px'}} colSpan="2">Availability Impact</th>
    </tr>
  </thead>
  <tbody>
    <tr style={{border: '2px solid black'}}>
      <td style={{border: '2px solid black', padding: '8px'}} colSpan="2">{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.accessVector}</td>
      <td style={{border: '2px solid black', padding: '8px'}} colSpan="2">{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.accessComplexity}</td>
      <td style={{border: '2px solid black', padding: '8px'}} colSpan="2">{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.authentication}</td>
      <td style={{border: '2px solid black', padding: '8px'}} colSpan="2">{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.confidentialityImpact}</td>
      <td style={{border: '2px solid black', padding: '8px'}} colSpan="2">{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.integrityImpact}</td>
      <td style={{border: '2px solid black', padding: '8px'}} colSpan="2">{selectedItem.cve.metrics.cvssMetricV2[0].cvssData.availabilityImpact}</td>
    </tr>
  </tbody>
</table>

             <h5>Exploitability Score:{selectedItem.cve.metrics.cvssMetricV2[0].exploitabilityScore}</h5>
             <h5>Impact Score:{selectedItem.cve.metrics.cvssMetricV2[0].impactScore}</h5>
             <h4>CPE:</h4>
             <table>
              <thead>
                <tr style={{border: '2px solid black'}}>
                  <th style={{border: '2px solid black', padding: '8px'}}>Criteria</th>
                  <th style={{border: '2px solid black', padding: '8px'}}>Match Criteria ID</th>
                  <th style={{border: '2px solid black', padding: '8px'}}>Vulnerable</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                <td style={{border: '2px solid black', padding: '8px'}}>{selectedItem.cve.configurations[0].nodes[0].cpeMatch[0].criteria}</td>
                <td style={{border: '2px solid black', padding: '8px'}}>{selectedItem.cve.configurations[0].nodes[0].cpeMatch[0].matchCriteriaId}</td>
                <td style={{border: '2px solid black', padding: '8px'}}>{selectedItem.cve.configurations[0].nodes[0].cpeMatch[0].vulnerable? 'True' : 'False'}</td>
                </tr>
              </tbody>
             </table>
             </div>
          )}
        </div>
      )}
    </div>
  );
};

export default CVEDetails;



